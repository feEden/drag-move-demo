(()=>{"use strict";var e={546:function(e,t,n){let r,l,o,i;var s=n("773"),u=n("699"),d=n("511");let c=(0,u.createContext)({}),a=e=>{let{children:t}=e,n=(0,u.useRef)(null),r=(0,u.useRef)([]),l=(0,u.useRef)(!1);return(0,s.jsx)(c.Provider,{value:{selectedChartIdsRef:r,maskInitPositionRef:n,isDragingRef:l},children:t})};var p=n("893");function h(e,t){let n=0,r=t.length-1;for(;n<=r;){let l=Math.round(r-(r-n)/2);if(e.pos<t[l].pos)r=l-1;else{if(!(e.pos>t[l].pos))return t[l];n=l+1}}if(n==r)return t[n];if(n>r)return n>=t.length?t[r]:r<0?t[0]:Math.abs(t[r].pos-e.pos)<Math.abs(t[n].pos-e.pos)?t[r]:t[n]}function f(e,t,n,r){return{v:[{type:"vl",pos:t,start:e,end:e+n},{type:"vm",pos:t+r/2,start:e,end:e+n},{type:"vr",pos:t+r,start:e,end:e+n}],h:[{type:"ht",pos:e,start:t,end:t+r},{type:"hm",pos:e+n/2,start:t,end:t+r},{type:"hb",pos:e+n,start:t,end:t+r}]}}let m=function(e,t){let n;!l&&(l=e),!o&&(o=t);let r=Math.abs(e-l),s=Math.abs(t-o);return n=r>s?"v":r<s?"h":i,l=e,o=t,i=n,n},v={vLines:[],hLines:[]};function y(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=[],l=[];for(let o=0;o<e.length;o++){let i=e[o];if(i===t)continue;let{offsetTop:s,offsetLeft:u,offsetHeight:d,offsetWidth:c}=i,a=f(s*n,u*n,d*n,c*n);r=r.concat(a.v),l=l.concat(a.h)}v.vLines=r.sort((e,t)=>e.pos-t.pos),v.hLines=l.sort((e,t)=>e.pos-t.pos)}function x(e,t){if("v"===e){if(0==v.vLines.length||0==t.v.length)return;return t.v.map(e=>h(e,v.vLines)).map((e,n)=>({val:Math.abs(e.pos-t.v[n].pos),from:t.v[n],...e})).sort((e,t)=>e.val-t.val).map((e,t)=>{let n=0===e.val;return 0===t&&e.val>0&&(n=!0),{type:e.type,display:n,pos:e.pos,start:Math.min(e.from.start,e.start),end:Math.max(e.from.end,e.end),from:e.from}})}if(0!=v.hLines.length&&0!=t.h.length)return t.h.map(e=>h(e,v.hLines)).map((e,n)=>({val:Math.abs(e.pos-t.h[n].pos),from:t.h[n],...e})).sort((e,t)=>e.val-t.val).map((e,t)=>{let n=0===e.val;return 0===t&&e.val>0&&(n=!0),{type:e.type,display:n,pos:e.pos,start:Math.min(e.from.start,e.start),end:Math.max(e.from.end,e.end),from:e.from}})}function b(){let e="view__align-line-root",t=document.getElementById(e);if(!t){let n=document.createElement("div");n.id=e,document.body.appendChild(n),t=n}return t}function g(e,t,n){let r=x("v",e),l=x("h",e);return(r&&r.length>0&&r.forEach((e,r)=>{!function(e,t,n,r){let{pos:l,start:o,end:i,display:s}=t,u="view__v-line_"+e,d=document.getElementById(u),c=b();if(!d){let e=document.createElement("div");e.id=u,e.className="view__v-line",c.appendChild(e),d=e}d.style.display=s?"block":"none",d.style.left=`${l+r}px`,d.style.top=`${o+n}px`,d.style.height=`${i-o}px`}(r,e,t,n)}),l&&l.length>0&&l.forEach((e,r)=>{!function(e,t,n,r){let{pos:l,start:o,end:i,display:s}=t,u="view__h-line_"+e,d=document.getElementById(u),c=b();if(!d){let e=document.createElement("div");e.id=u,e.className="view__h-line",c.appendChild(e),d=e}d.style.display=s?"block":"none",d.style.left=`${o+r}px`,d.style.top=`${l+n}px`,d.style.width=`${i-o}px`}(r,e,t,n)}),r||l)?{vLine:r?r.find(e=>e.display):null,hLine:l?l.find(e=>e.display):null}:null}let w=()=>{let e=b();e.parentNode&&e.parentNode.removeChild(e)};function $(){let e="view__dist-line-root",t=document.getElementById(e);if(!t){let n=document.createElement("div");n.id=e,document.body.appendChild(n),t=n}return t}function C(e,t,n,r,l){let{start:o,end:i}=t,s=t.pos,u=n.pos;"v"===e?!function(e,t,n){let{pos:r,start:l,end:o}=e,i="view__h-dist-line",s=document.getElementById(i),u=$();if(!s){let e=document.createElement("div");e.id=i,e.className=i,u.appendChild(e),s=e}let d=l,c=o;l>o&&(d=o,c=l),s.innerHTML=`<div class="label">${q(c-d,0)}</div>`,s.style.display="block",s.style.left=`${d+n}px`,s.style.top=`${r+t}px`,s.style.width=`${Math.abs(c-d)}px`}({start:s,end:u,pos:(i+o)/2},r,l):!function(e,t,n){let{pos:r,start:l,end:o}=e,i="view__v-dist-line",s=document.getElementById(i),u=$();if(!s){let e=document.createElement("div");e.id=i,e.className=i,u.appendChild(e),s=e}let d=l,c=o;l>o&&(d=o,c=l),s.innerHTML=`<div class="label">${q(c-d,0)}</div>`,s.style.display="block",s.style.left=`${r+n}px`,s.style.top=`${d+t}px`,s.style.height=`${Math.abs(c-d)}px`}({start:s,end:u,pos:(i+o)/2},r,l)}let E=()=>{let e=$();e.parentNode&&e.parentNode.removeChild(e)},k=()=>{let e=document.getElementById("view__resize-label");if(!!e)e.parentNode&&e.parentNode.removeChild(e)};function _(e,t){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="view__resize-label",l=e.getBoundingClientRect(),o=document.getElementById(r);if(!o){let e=document.createElement("div");e.id=r,e.className=r,document.body.appendChild(e),o=e}let i=l.width,s=0;if(n){let{width:t,height:n}=e.firstChild.getBoundingClientRect();i=t,s=n}o.style.display="block",o.style.top=`${l.bottom+s+10}px`,o.style.left=`${l.left+i/2}px`,o.innerHTML=t}function L(e){let t=`view__${e}-dist-line-root`,n=document.getElementById(t);if(!n){let e=document.createElement("div");e.id=t,document.body.appendChild(e),n=e}return n}function M(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0,r=0,l=1,o=[],i="v"===e?"vr":"hb",s="v"===e?"vl":"ht",u=(n[0].end-n[0].start)/2+n[0].start,d=t.concat(n).filter(e=>0!==e.start&&"vm"!==e.type&&"hm"!==e.type&&(!!(e.start<u)&&!!(e.end>u)||!1)).sort((e,t)=>e.pos-t.pos);for(;l<d.length;){if(d[r].type===i){if(d[l].type!==s){l++;continue}if(d[r].pos<=n[0].pos&&d[l].pos>=n[2].pos){r++;continue}o.push([r,l])}r++,l++}return o.map(e=>{let[t,n]=e;return{from:d[t],to:d[n],dist:d[n].pos-d[t].pos}})}function S(e,t){let n,r,l=t[0],o=t[2];return e.length<=1?[]:(e.forEach((t,i)=>{let{from:s,to:u}=t;if(l.pos===u.pos){if(i<1)return;let t=e[i-1].dist;n=s.pos+t}if(o.pos===s.pos){if(i>=e.length-1)return;let t=e[i+1].dist;r=u.pos-t}}),[n,r])}let R=(e,t,n,r)=>{"h"===e?!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;N("h"),e.forEach(e=>{let{from:r,to:l}=e,o=Math.min(r.start,l.start,r.end,l.end),i=Math.max(r.start,l.start,r.end,l.end);!function(e,t,n){let{pos:r,start:l,end:o,width:i}=e,s="view__v-space-line_"+l,u=L("v"),d=document.getElementById(s);if(!d){let e=document.createElement("div");e.id=s,e.className="view__v-space-line",u.appendChild(e),d=e}let c=l,a=o;l>o&&(c=o,a=l),d.innerHTML='<i class="line"/>',d.style.display="block",d.style.left=`${r+n}px`,d.style.top=`${c+t}px`,d.style.width=`${i}px`,d.style.height=`${Math.abs(a-c)}px`}({pos:(r.start+r.end)/2,start:r.pos,end:l.pos,width:i-o},t,n)})}(M("h",v.hLines,t.h),n,r):!function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;N("v"),e.forEach(e=>{let{from:r,to:l}=e,o=Math.min(r.start,l.start,r.end,l.end),i=Math.max(r.start,l.start,r.end,l.end);!function(e,t,n){let{pos:r,start:l,end:o,height:i}=e,s="view__h-space-line_"+l,u=L("h"),d=document.getElementById(s);if(!d){let e=document.createElement("div");e.id=s,e.className="view__h-space-line",u.appendChild(e),d=e}let c=l,a=o;l>o&&(c=o,a=l),d.innerHTML='<i class="line"/>',d.style.display="block",d.style.left=`${c+n}px`,d.style.top=`${r+t}px`,d.style.width=`${Math.abs(a-c)}px`,d.style.height=`${i}px`}({pos:(r.start+r.end)/2,start:r.pos,end:l.pos,height:i-o},t,n)})}(M("v",v.vLines,t.v),n,r)},I=(e,t)=>{let n,r;return n="h"===e?S(r=M("h",v.hLines,t.h),t.h):S(r=M("v",v.vLines,t.v),t.v)},N=e=>{let t=document.getElementById(`view__${e}-dist-line-root`);if(!!t)t.remove()},B=(e,t)=>{let{dom:n,top:r,left:l,scaleSize:o=1,isMultiMove:i=!1}=e;if(!n)return;let s=n.parentNode.getBoundingClientRect(),u=s.top,d=s.left,{height:c,width:a}=n.getBoundingClientRect();if(i){let{width:e,height:t}=n.firstChild.getBoundingClientRect();c=t,a=e}let p=m(r,l),h=f(r,l,c,a),v=l,y=r,x=function(e,t,n,r,l){let{top:o,left:i,width:s,height:u}=n,d=i,c=o;if("h"==e){let[e,n]=I("v",t);d>e-6&&d<e+6&&R("v",f(c,d=e,u,s),r,l),d>n-s-6&&d<n-s+6&&R("v",f(c,d=n-s,u,s),r,l)}else{let[e,n]=I("h",t);c>e-6&&c<e+6&&R("h",f(c=e,d,u,s),r,l),c>n-u-6&&c<n-u+6&&R("h",f(c=n-u,d,u,s),r,l)}return{top:c,left:d}}(p,h,{top:y,left:v,width:a,height:c},u,d);y=x.top;let b=function(e,t,n,r){let{top:l,left:o,width:i,height:s}=t,u=g(e,n,r),d=o,c=l;if(u){var a,p,h,m,v,y;let e,t,{vLine:x,hLine:b}=u;let w=(a=l,p=o,h=s,m=i,v=x,y=b,e=p,t=a,v?v.from.pos<v.pos+6&&v.from.pos>v.pos-6&&("vl"===v.from.type?e=v.pos:"vm"===v.from.type?e=v.pos-m/2:"vr"===v.from.type&&(e=v.pos-m)):e=p,y?y.from.pos<y.pos+6&&y.from.pos>y.pos-6&&("ht"===y.from.type?t=y.pos:"hm"===y.from.type?t=y.pos-h/2:"hb"===y.from.type&&(t=y.pos-h)):t=a,{top:t,left:e});d=w.left,(l!=(c=w.top)||o!=d)&&g(f(c,d,s,i),n,r);let $=x.from,E=b.from,k={vl:0,vm:1,vr:2,ht:0,hm:1,hb:2};if(d!=o||c!=l){let e=f(c,d,s,i);$=e.v[k[$.type]],E=e.h[k[E.type]]}C("v",$,x,n,r),C("h",E,b,n,r)}return{top:c,left:d}}(h,{top:y,left:v=x.left,width:a,height:c},u,d);y=q(b.top/o,0),v=q(b.left/o,0),n.style.left=`${v}px`,n.style.top=`${y}px`,_(n,`${y} x ${v}`,i),null==t||t({y:y,x:v,h:c/o,w:a/o})},j=(e,t)=>{let{dom:n,top:l,left:o,height:i,width:s,scaleSize:u}=e;if(!n)return;let d=n.parentNode.getBoundingClientRect(),c=d.top,a=d.left,p=function(e,t,n,l){if(!r)return r={top:e,left:t,height:n,width:l},[];let o=[];return e!==r.top&&o.push("ht"),t!==r.left&&o.push("vl"),e===r.top&&t===r.left&&l!==r.width&&o.push("vr"),e===r.top&&t===r.left&&n!==r.height&&o.push("hb"),o}(l,o,i,s),h=g(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=e.v.filter(e=>t.indexOf(e.type)>=0);return{v:n,h:e.h.filter(e=>t.indexOf(e.type)>=0)}}(f(l,o,i,s),p),c,a),m=o,v=l,y=i,x=s;if(h){var b,w,$,E,k,L;let e,t,n,r,{vLine:u,hLine:d}=h;let p=(b=l,w=o,$=i,E=s,k=u,L=d,e=w,t=b,n=$,r=E,k&&k.from.pos<k.pos+6&&k.from.pos>k.pos-6&&("vl"===k.from.type?(e=k.pos,r=E+(k.from.pos-k.pos)):"vm"===k.from.type||"vr"===k.from.type&&(r=E+(k.pos-k.from.pos),e=k.pos-r)),L&&L.from.pos<L.pos+6&&L.from.pos>L.pos-6&&("ht"===L.from.type?(t=L.pos,n=$+(L.from.pos-L.pos)):"hm"===L.from.type?t=L.pos-$/2:"hb"===L.from.type&&(n=$+(L.pos-L.from.pos),t=L.pos-n)),{top:t,left:e,height:n,width:r});m=p.left,v=p.top,y=p.height,x=p.width,(o!=m||l!=v||i!=y||s!=x)&&g(f(v,m,y,x),c,a);let _={vl:0,vm:1,vr:2,ht:0,hm:1,hb:2};if(u){let e=u.from;(m!=o||x!=s)&&(e=f(v,m,y,x).v[_[e.type]]),C("v",e,u,c,a)}if(d){let e=d.from;(v!=l||y!=i)&&(e=f(v,m,y,x).h[_[e.type]]),C("h",e,d,c,a)}}let M=q(v/u,0),S=q(m/u,0),R=q(x/u,0),I=q(y/u,0);n.style.top=`${M}px`,n.style.left=`${S}px`,n.firstChild.style.height=`${I}px`,n.firstChild.style.width=`${R}px`,_(n,`${R} x ${I}`,!0),null==t||t({y:M,x:S,h:I,w:R})},O=(e,t)=>{let n=e.x,r=e.x+e.w,l=e.y,o=e.y+e.h,i=t.x,s=t.x+t.w,u=t.y,d=t.y+t.h;return r>i&&n<s&&o>u&&l<d},T=()=>navigator.userAgent.indexOf("Mac OS")>=0,z=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return window.crypto&&window.crypto.getRandomValues?(0,p.x0)(e):Math.random().toString(16).slice(2,2+e)};function q(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Number(e);return isNaN(r)?"-":n?r.toFixed(t):Number(r.toFixed(t))}var X=n("990");let Y=e=>{let{setPageList:t,pageKey:n,selectedChartIdsRef:r,chartList:l,maskInitPositionRef:o}=e,i=(0,u.useRef)({}),s=(0,u.useRef)(null),d=(0,u.useCallback)(e=>{let n=[...l];Object.keys(e).forEach(t=>{n[t].layout=e[t]}),t(n)},[n,l]),c=(0,u.useCallback)(()=>{let e=i.current;!(0,X.isEmpty)(e)&&(d(e),o.current=s.current),i.current={},s.current=null},[d]),a=(0,u.useCallback)((e,t)=>{let{x:n,y:r,w:l,h:o}=e,{w:i,h:s,x:u,y:d}=t;return{changedW:i-l,changedH:s-o,changedLeft:u-n,changedTop:d-r}},[]),p=(0,u.useCallback)(e=>{let{changedLeft:t,changedTop:n}=a(o.current,e),{w:u,h:d}=e,c=u/o.current.w,p=d/o.current.h,h=0!==t||0!==n;r.current.forEach(t=>{let n=document.getElementById(t);if(n){let r=l.findIndex(e=>e.id===t);if(r>-1){let{layout:{x:t,y:s,w:u,h:d}}=l[r],a={x:t,y:s,w:u*c,h:d*p},f=h?e:o.current;a.x=f.x+(t-o.current.x)*c,a.y=f.y+(s-o.current.y)*p,n.style.cssText+=`left: ${a.x}px;top: ${a.y}px;width: ${a.w}px;height: ${a.h}px`,i.current[r]=a}}}),s.current=e},[a,l]);return{onUpdateCardItem:(0,u.useCallback)(e=>{let{changedLeft:t,changedTop:n}=a(o.current,e);r.current.forEach(e=>{let r=document.getElementById(e);if(r){let o=l.findIndex(t=>t.id===e);if(o>-1){let{layout:{x:e,y:s,w:u,h:d}}=l[o],c=e+t,a=s+n;r.style.cssText+=`left: ${c}px;top: ${a}px;`,i.current[o]={x:c,y:a,w:u,h:d}}}}),s.current=e},[a,l]),onUpdateCardResizeItem:p,onMouseUpCallback:c}},P="CARD_MASK_WRAPPER_ID_NAME",U=e=>{let{pageKey:t,scaleSize:n,onMouseUpCallback:l,onUpdateCardItem:o,selectedChartIdsRef:i}=e,{isDragingRef:d}=(0,u.useContext)(c),a=(0,u.useRef)(null),p=(0,u.useRef)(null),h=(0,u.useCallback)(e=>{document.body.style.userSelect="auto",document.body.style.webkitUserSelect="auto",p.current=null,d.current=!1,r=null,w(),N("h"),N("v"),E(),k(),null==l||l(),document.removeEventListener("mousemove",a.current)},[l]),f=(0,u.useCallback)((e,t)=>{let r,l,i,s,{type:u,moveDom:c,parentRect:a}=t;if(e.stopPropagation(),!d.current)return;document.body.style.userSelect="none",document.body.style.webkitUserSelect="none";let{event:{x:h,y:f},w:m,h:v,moveLastBoundingClientRect:y}=p.current,{left:x,top:b}=y,{x:g,y:w}=a,$=e.clientX-h,C=e.clientY-f;switch(u){case"bc":i=m,s=v+C,r=x-g,l=(s>0?b:b+s)-w;break;case"tc":i=m,s=v-C,r=x-g,l=(s>0?b+C:v+b)-w;break;case"lc":s=v,i=m-$,l=b-w,r=(i>0?x+$:m+x)-g;break;case"rc":s=v,i=m+$,l=b-w,r=(i>0?x:x+i)-g;break;case"br":i=m+$,s=v+C,r=(i>0?x:x+i)-g,l=(s>0?b:b+s)-w;break;case"bl":i=m-$,s=v+C,r=(i>0?x+$:m+x)-g,l=(s>0?b:b+s)-w;break;case"tl":i=m-$,s=v-C,r=(i>0?x+$:m+x)-g,l=(s>0?b+C:v+b)-w;break;case"tr":i=m+$,s=v-C,r=(i>0?x:x+i)-g,l=(s>0?b+C:v+b)-w}j({dom:c,top:l,left:r,height:Math.abs(s),width:Math.abs(i),scaleSize:n},e=>{o(e)})},[n,o]),m=(0,u.useCallback)(e=>{if(e.stopPropagation(),d.current)return;d.current=!0;let r=document.querySelector(`#${t} #${P}`),l=document.querySelector(`#${t}`);y(Array.from(l.children).filter(e=>!i.current.includes(e.id)),r,n);let o=l.getBoundingClientRect(),s=e.target.className,u=r.getBoundingClientRect(),{offsetWidth:c,offsetHeight:m}=r.firstChild;p.current={event:{x:e.clientX,y:e.clientY},w:c,h:m,moveLastBoundingClientRect:u},a.current=e=>f(e,{type:s,parentRect:o,moveDom:r}),document.addEventListener("mousemove",a.current),document.addEventListener("mouseup",h)},[t,n,f,h]);return(0,u.useEffect)(()=>()=>{document.removeEventListener("mouseup",h),document.removeEventListener("mousemove",a.current)},[h]),(0,s.jsx)(s.Fragment,{children:["tl","tr","bl","br","tc","bc","lc","rc"].map(e=>(0,s.jsx)("i",{className:e,onMouseDown:m},e))})},A=e=>{var t,n;let{chartList:r,setPageList:l,pageKey:o,scaleSize:i}=e,{maskInitPositionRef:d,selectedChartIdsRef:a}=(0,u.useContext)(c),{onUpdateCardResizeItem:p,onMouseUpCallback:h}=Y({pageKey:o,chartList:r,setPageList:l,selectedChartIdsRef:a,maskInitPositionRef:d});return(0,s.jsx)("div",{id:P,className:"card-mask-wrapper",style:{zIndex:r.length+1},children:(0,s.jsx)("div",{style:{width:`${null===(t=d.current)||void 0===t?void 0:t.w}px`,height:`${null===(n=d.current)||void 0===n?void 0:n.h}px`,zIndex:r.length+2},className:"card-mask-item",children:(0,s.jsx)(U,{pageKey:o,scaleSize:i,selectedChartIdsRef:a,onUpdateCardItem:p,onMouseUpCallback:h})})})};var H=n("881"),D=n("63");let F=e=>{let{pageKey:t}=e,{maskInitPositionRef:n}=(0,u.useContext)(c),r=(0,u.useCallback)(e=>{let t=0,n=0,r=0,l=0;return e.forEach((e,o)=>{let{layout:{x:i,y:s,w:u,h:d}}=e;o?(t=Math.min(t,i),l=Math.min(l,s),i+u>n&&(n=i+u),s+d>r&&(r=s+d)):(t=i,l=s,n=u+i,r=d+s)}),{left:t,top:l,width:n,height:r}},[]),l=(0,u.useCallback)((e,l)=>{let o=document.querySelector(`#${t} #${P}`);if(!(0,X.isEmpty)(e)&&o){let{left:t,top:i,width:s,height:u}=r(l.filter(t=>{let{id:n}=t;return e.includes(n)}));n.current={x:t,y:i,w:s-t,h:u-i},o.style.cssText+=`display: block; left: ${t}px; top: ${i}px;`,o.firstChild.style.cssText+=`width: ${s-t}px; height: ${u-i}px`}o=null},[t,r]);return{onCreatePageChartsMaskDiv:l,onHideMaskCard:(0,u.useCallback)(()=>{if(t&&"-1"!==t){let e=document.querySelector(`#${t} #${P}`);e&&(e.style.cssText+="display: none;",e=null)}},[t])}};var K=n("814");let W=e=>{let{isDataEdit:t,pageKey:n,chartList:r,scaleSize:l,maskInitPositionRef:o,selectedChartIdsRef:i,setPageList:s,onCreatePageChartsMaskDiv:d,onReseListenerMouseEventState:a,setCurPageSelectedChartId:p}=e,{isDragingRef:h}=(0,u.useContext)(c),f=(0,u.useRef)({top:0,left:0,clientX:0,clientY:0}),m=(0,u.useRef)(null),v=(0,u.useRef)({x:null,y:null}),x=(0,u.useRef)(null),{onUpdateCardItem:b,onMouseUpCallback:g}=Y({setPageList:s,pageKey:n,selectedChartIdsRef:i,chartList:r,maskInitPositionRef:o}),$=(0,u.useCallback)(()=>{var e;return null===(e=document.querySelector(`#${n}`))||void 0===e?void 0:e.getBoundingClientRect()},[n]),C=(0,u.useCallback)(()=>{let{left:e,top:t}=document.querySelector(`#${n}`).getBoundingClientRect();return{x:e,y:t}},[n]),_=(0,u.useCallback)(e=>{var t;let n=e.target,o=n.id;if(null===(t=n.id)||void 0===t?void 0:t.startsWith("chart_"))return o;let{x:i,y:s}=C(),{clientX:u,clientY:d}=e,c=(u-i)/l,a=(d-s)/l,p=null;return r.forEach(e=>{let{layout:{x:t,y:n,w:r,h:l}}=e;c>=t&&c<=t+r&&a>=n&&a<=n+l&&((null==p?void 0:p.zIndex)??-1<e.zIndex)&&(p=e)}),null==p?void 0:p.id},[r,C,l]),L=(0,u.useCallback)((e,t)=>{let{moveDom:n}=t;if(!h.current)return;document.body.style.userSelect="none",document.body.style.webkitUserSelect="none";let{left:r,top:o,clientX:i,clientY:s}=f.current,u=e.clientX-i,d=e.clientY-s;(u||d)&&B({dom:n,top:o+d,left:r+u,scaleSize:l,isMultiMove:!0},e=>{b(e)})},[l,b]),M=(0,u.useCallback)(e=>{window.removeEventListener("mousemove",x.current),w(),N("h"),N("v"),E(),k(),null==g||g(),h.current=!1,document.body.style.userSelect="auto",document.body.style.webkitUserSelect="auto",window.removeEventListener("mouseup",M)},[g]),S=(0,u.useCallback)((e,t)=>{let{selectedIds:r}=t,o=document.querySelector(`#${n} #${P}`);if(!o||h.current)return;h.current=!0;let i=document.querySelector(`#${n}`),{left:s,top:u}=o.getBoundingClientRect(),{left:d,top:c}=i.getBoundingClientRect();f.current.top=u-c,f.current.left=s-d,f.current.clientY=e.clientY,f.current.clientX=e.clientX,y(Array.from(i.children).filter(e=>!r.includes(e.id)),o,l),x.current=e=>L(e,{moveDom:o}),window.addEventListener("mousemove",x.current),window.addEventListener("mouseup",M)},[n,L,M]),R=(0,u.useCallback)(e=>{if(!h.current)return;let{x:t,y:n}=v.current,o=e.clientX-t,s=e.clientY-n,u=Math.abs(o),c=Math.abs(s),p=Math.min(e.clientX,t),f=Math.min(e.clientY,n),y=`left: ${p}px; top: ${f}px; width: ${u}px; height: ${c}px;`;if(m.current)m.current.style.cssText+=y,document.body.appendChild(m.current);else{let e=document.createElement("div");e.setAttribute("id","tmp_drag_select_rect"),e.style.cssText+=`${y} position: absolute; border: 1px solid #3b82f6; background: rgba(24, 94, 192, 0.2); z-index: 100000`,document.body.appendChild(e),m.current=e}let{left:x,top:b}=$(),g={x:(p-x)/l,y:(f-b)/l,w:u/l,h:c/l},w=i.current;r.forEach(e=>{let{layout:t,id:n}=e;O(g,t)?!w.includes(n)&&w.push(n):w=w.filter(e=>e!==n)}),(0,X.isEmpty)(w)?a():d(w,r),i.current=w},[r,l,$,d,a,O]),I=(0,u.useCallback)(e=>{var t;if(window.removeEventListener("mousemove",R),null===(t=i.current)||void 0===t?void 0:t.length){let t=document.querySelector(`#${n}`),r=e.target;t.contains(r)&&(!_(e)&&!m.current&&a(),1===i.current.length&&p(i.current[0]))}m.current&&m.current.remove(),h.current=!1,document.body.style.userSelect="auto",document.body.style.webkitUserSelect="auto",v.current={x:null,y:null},m.current=null,window.removeEventListener("mouseup",I)},[n,_,a,R]),j=(0,u.useCallback)(e=>{let t=document.querySelector(`#${n}`),l=e.target;if(null==t?void 0:t.contains(l)){var o,s;let t=_(e);if(t){!(null===(s=i.current)||void 0===s?void 0:s.includes(t))&&(i.current=[t],d(i.current,r)),p(t),S(e,{selectedIds:i.current});return}if(null===(o=i.current)||void 0===o?void 0:o.includes(t))return;h.current=!0,v.current={x:e.clientX,y:e.clientY},document.body.style.userSelect="none",document.body.style.webkitUserSelect="none",window.addEventListener("mousemove",R),window.addEventListener("mouseup",I)}},[n,_,r,S,R,I]);(0,K.Z)(()=>{if(!t&&!(0,X.isEmpty)(r))return window.addEventListener("mousedown",j),()=>{window.removeEventListener("mousedown",j),window.removeEventListener("mouseup",I),window.removeEventListener("mousemove",R),window.removeEventListener("mousemove",x.current),window.removeEventListener("mouseup",M),x.current=null}},[t,r,R,j,I,M])},V=(0,n("426").cn)(),Z=e=>{let{setPageList:t,chartList:n,pageKey:r,isDataEdit:l,scaleSize:o,setCurPageSelectedChartId:i}=e,{selectedChartIdsRef:s,maskInitPositionRef:d}=(0,u.useContext)(c),a=(0,H.b9)(V),p=T(),{onCreatePageChartsMaskDiv:h,onHideMaskCard:f}=F({pageKey:r}),m=(0,u.useCallback)(()=>{f(),a(""),s.current=[],d.current=null},[f]);return W({isDataEdit:l,pageKey:r,chartList:n,scaleSize:o,maskInitPositionRef:d,selectedChartIdsRef:s,setCurPageSelectedChartId:i,setPageList:t,onCreatePageChartsMaskDiv:h,onReseListenerMouseEventState:m}),(0,D.y1)(`${p?"meta":"ctrl"}+a`,e=>{if(e.preventDefault(),!l){let e=(null==n?void 0:n.map(e=>{let{id:t}=e;return t}))||[];if(!(0,X.isEmpty)(e))s.current=e,h(e,n)}}),(0,D.y1)("backspace",e=>{e.preventDefault(),(s.current??[]).forEach(e=>{let t=n.findIndex(t=>t.id===e);-1!==t&&n.splice(t,1)}),t([...n]),m()}),(0,u.useEffect)(()=>()=>{m()},[]),{onReseListenerMouseEventState:m}},G="_pageKey_",J=()=>{let[e,t]=(0,u.useState)([]),[n,r]=(0,u.useState)(""),{onReseListenerMouseEventState:l}=Z({chartList:e,pageKey:G,isDataEdit:!1,scaleSize:1,setPageList:t,setCurPageSelectedChartId:r});return(0,u.useEffect)(()=>()=>{l()},[]),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"w-[80px] h-full border-r border-solid border-slate-400 flex justify-center",children:(0,s.jsx)("button",{onClick:()=>{t(e=>[...e,{id:`chart_${z()}`,label:z(),zIndex:e.length+1,layout:{w:500,h:300,x:0,y:0}}])},className:"h-[32px] text-gray-700 px-[16px] rounded-[4px] mt-[8px] text-[16px] border border-slate-500",children:"add"})}),(0,s.jsxs)("div",{className:"flex-1 h-full relative p-[16px]",id:G,children:[e.map(e=>{let{label:t,layout:n,id:r}=e;return(0,s.jsx)("div",{id:r,style:{left:`${n.x}px`,top:`${n.y}px`,width:`${n.w}px`,height:`${n.h}px`},className:"bg-sky-200 rounded-[4px] flex justify-center items-center absolute cursor-move overflow-hidden border border-purple-500",children:t},r)}),(0,s.jsx)(A,{setPageList:t,chartList:e,pageKey:G,scaleSize:1})]})]})},Q=document.getElementById("root");Q&&d.createRoot(Q).render((0,s.jsx)(u.StrictMode,{children:(0,s.jsx)(()=>(0,s.jsx)(a,{children:(0,s.jsx)(J,{})}),{})}))}},t={};function n(r){var l=t[r];if(void 0!==l)return l.exports;var o=t[r]={id:r,loaded:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.loaded=!0,o.exports}n.m=e,n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.nmd=function(e){return e.paths=[],!e.children&&(e.children=[]),e},(()=>{var e=[];n.O=function(t,r,l,o){if(r){o=o||0;for(var i=e.length;i>0&&e[i-1][2]>o;i--)e[i]=e[i-1];e[i]=[r,l,o];return}for(var s=1/0,i=0;i<e.length;i++){for(var r=e[i][0],l=e[i][1],o=e[i][2],u=!0,d=0;d<r.length;d++)(!1&o||s>=o)&&Object.keys(n.O).every(function(e){return n.O[e](r[d])})?r.splice(d--,1):(u=!1,o<s&&(s=o));if(u){e.splice(i--,1);var c=l();void 0!==c&&(t=c)}}return t}})(),n.rv=function(){return"1.1.8"},(()=>{var e={980:0};n.O.j=function(t){return 0===e[t]};var t=function(t,r){var l=r[0],o=r[1],i=r[2],s,u,d=0;if(l.some(function(t){return 0!==e[t]})){for(s in o)n.o(o,s)&&(n.m[s]=o[s]);if(i)var c=i(n)}for(t&&t(r);d<l.length;d++)u=l[d],n.o(e,u)&&e[u]&&e[u][0](),e[u]=0;return n.O(c)},r=self.webpackChunkdrag_move=self.webpackChunkdrag_move||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})(),n.ruid="bundler=rspack@1.1.8";var r=n.O(void 0,["361","323"],function(){return n("546")});r=n.O(r)})();